# Physical AI Textbook RAG Chatbot - System Architecture

## ğŸ“ Visual Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         STUDENT INTERFACE                           â”‚
â”‚                    (Docusaurus + React Frontend)                    â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Homepage            Docs Pages           Blog              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚  â”‚ Hero   â”‚          â”‚ ROS 2  â”‚          â”‚ Posts  â”‚        â”‚  â”‚
â”‚  â”‚  â”‚ Vision â”‚          â”‚ Isaac  â”‚          â”‚ ...    â”‚        â”‚  â”‚
â”‚  â”‚  â”‚ ...    â”‚          â”‚ VLA    â”‚          â”‚        â”‚        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  ğŸ¤– ChatAssistant Component (Floating)               â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - Click to open chat window                         â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - Send messages to backend                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  - Display AI responses + sources                    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚                              HTTP POST                              â”‚
â”‚                    http://localhost:8000/chat                       â”‚
â”‚                                   â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BACKEND SERVER (FastAPI)                        â”‚
â”‚                        Port 8000 (Python)                           â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Endpoint: POST /chat                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  1. Receive: {message, conversation_history}          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  2. Call: run_agent(message, history)                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  3. Return: {response, sources}                        â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  OpenAI Agent (GPT-4o)                                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  System Prompt (Constitution):                        â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  "You are the AI Tutor for Physical AI course.       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   Answer ONLY from textbook content.                  â”‚ â”‚  â”‚
â”‚  â”‚  â”‚   Use retrieve_knowledge() tool before answering."    â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  Tool: retrieve_knowledge(query: str)                 â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  1. Embed query with Cohere                     â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  2. Search Qdrant (top 5 results)               â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â”‚  3. Return context + metadata                    â”‚ â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â”‚                              Calls APIs                              â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚                        â”‚                     â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â–¼                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Cohere Embeddings     â”‚   â”‚   OpenAI LLM         â”‚
        â”‚   embed-english-v3.0    â”‚   â”‚   GPT-4o             â”‚
        â”‚                         â”‚   â”‚                      â”‚
        â”‚   Query â†’ 1024D Vector  â”‚   â”‚   Chat Completions   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   Function Calling   â”‚
                    â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Qdrant Vector DB      â”‚
        â”‚   (Cloud Hosted)        â”‚
        â”‚                         â”‚
        â”‚   Collection:           â”‚
        â”‚   physical_ai_book      â”‚
        â”‚                         â”‚
        â”‚   Vectors: 523          â”‚
        â”‚   Dimensions: 1024      â”‚
        â”‚   Distance: Cosine      â”‚
        â”‚                         â”‚
        â”‚   Payload:              â”‚
        â”‚   - text (chunk)        â”‚
        â”‚   - title               â”‚
        â”‚   - module              â”‚
        â”‚   - file_path           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–²
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Data Ingestion       â”‚
        â”‚   (ingest_data.py)     â”‚
        â”‚                        â”‚
        â”‚   1. Load MDX files    â”‚
        â”‚   2. Clean content     â”‚
        â”‚   3. Chunk text        â”‚
        â”‚   4. Embed with Cohere â”‚
        â”‚   5. Upsert to Qdrant  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–²
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Textbook Content     â”‚
        â”‚   (docs/ directory)    â”‚
        â”‚                        â”‚
        â”‚   44 MDX files:        â”‚
        â”‚   - 01-Introduction    â”‚
        â”‚   - 02-Module-1-ROS2   â”‚
        â”‚   - 03-Module-2-Sim    â”‚
        â”‚   - 04-Module-3-Brain  â”‚
        â”‚   - 05-Module-4-VLA    â”‚
        â”‚   - 07-Module-5-Human  â”‚
        â”‚   - 08-Module-6-Ctrl   â”‚
        â”‚   - 06-Appendices      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Diagram

### Ingestion Pipeline (One-time setup)

```
MDX Files
    â”‚
    â–¼
[Load & Parse]
    â”‚
    â”œâ”€ Extract frontmatter (title, position)
    â”œâ”€ Remove JSX imports
    â””â”€ Clean HTML tags
    â”‚
    â–¼
[Chunk Text]
    â”‚
    â”œâ”€ Split by sections (## headers)
    â”œâ”€ Preserve code blocks (```)
    â””â”€ Create 800-token chunks with 100 overlap
    â”‚
    â–¼
[Embed with Cohere]
    â”‚
    â”œâ”€ Batch embed (up to 96 texts)
    â”œâ”€ Model: embed-english-v3.0
    â””â”€ Output: 1024D vectors
    â”‚
    â–¼
[Upsert to Qdrant]
    â”‚
    â”œâ”€ Point ID (incremental)
    â”œâ”€ Vector (1024D float array)
    â””â”€ Payload (text, title, module, file_path)
    â”‚
    â–¼
[âœ… 523 Vectors Stored]
```

### Query Pipeline (Runtime)

```
Student Question: "What is ROS 2?"
    â”‚
    â–¼
[ChatAssistant UI]
    â”‚
    â”œâ”€ User types message
    â”œâ”€ Click send
    â””â”€ HTTP POST to /chat
    â”‚
    â–¼
[FastAPI Backend]
    â”‚
    â”œâ”€ Validate request
    â”œâ”€ Extract message + history
    â””â”€ Call run_agent()
    â”‚
    â–¼
[OpenAI Agent - First Call]
    â”‚
    â”œâ”€ Receive system prompt
    â”œâ”€ Receive conversation history
    â”œâ”€ Receive user message
    â””â”€ Decide: "I need to search the textbook"
    â”‚
    â–¼
[Function Call: retrieve_knowledge]
    â”‚
    â”œâ”€ Query: "What is ROS 2?"
    â”‚
    â–¼
[Cohere Embedding]
    â”‚
    â”œâ”€ Embed query â†’ 1024D vector
    â””â”€ Time: ~100ms
    â”‚
    â–¼
[Qdrant Vector Search]
    â”‚
    â”œâ”€ Cosine similarity search
    â”œâ”€ Return top 5 most similar chunks
    â””â”€ Time: ~50ms
    â”‚
    â–¼
[Retrieved Context]
    â”‚
    â”œâ”€ Chunk 1: "ROS 2 is an open-source middleware..." (score: 0.92)
    â”œâ”€ Chunk 2: "Key features of ROS 2 include..." (score: 0.89)
    â”œâ”€ Chunk 3: "ROS 2 uses DDS for communication..." (score: 0.85)
    â”œâ”€ Chunk 4: "Installation of ROS 2..." (score: 0.81)
    â””â”€ Chunk 5: "ROS 2 vs ROS 1..." (score: 0.78)
    â”‚
    â–¼
[OpenAI Agent - Second Call]
    â”‚
    â”œâ”€ Receive retrieved context
    â”œâ”€ Generate answer from context ONLY
    â”œâ”€ Cite sources
    â””â”€ Time: ~1-3 seconds
    â”‚
    â–¼
[Response Generated]
    â”‚
    â”œâ”€ Answer: "ROS 2 (Robot Operating System 2) is..."
    â””â”€ Sources: [{title: "ROS 2 Nodes", module: "Module 1", score: 0.92}]
    â”‚
    â–¼
[FastAPI Return]
    â”‚
    â””â”€ JSON: {response: "...", sources: [...]}
    â”‚
    â–¼
[ChatAssistant Display]
    â”‚
    â”œâ”€ Show AI message
    â”œâ”€ Show sources (module badges)
    â””â”€ Smooth animation
    â”‚
    â–¼
[âœ… Student sees answer]
```

---

## ğŸ§  Agent Decision Tree

```
User Message Received
    â”‚
    â–¼
Is this a greeting? â”€â”€yesâ”€â”€> Respond directly
    â”‚
    no
    â–¼
Is this about the course? â”€â”€noâ”€â”€> "I only answer course questions"
    â”‚
    yes
    â–¼
Call retrieve_knowledge(user_message)
    â”‚
    â–¼
Context retrieved?
    â”‚
    â”œâ”€ yes â”€â”€> Generate answer from context
    â”‚           â””â”€> Add source citations
    â”‚
    â””â”€ no â”€â”€> "I don't have that info in the textbook"
    â”‚
    â–¼
Return response to student
```

---

## ğŸ“Š Component Interaction Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docusaurus    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  React         â”‚
â”‚  (Framework)   â”‚         â”‚  (Components)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Uses
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ ChatAssistant  â”‚
                          â”‚ - UI           â”‚
                          â”‚ - Animation    â”‚
                          â”‚ - HTTP Client  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ POST
                                   â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ FastAPI        â”‚
                          â”‚ - Routing      â”‚
                          â”‚ - Validation   â”‚
                          â”‚ - CORS         â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ Orchestrates
                                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                             â”‚
                    â–¼                             â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚  OpenAI Agent  â”‚          â”‚ retrieve_know  â”‚
           â”‚  - GPT-4o      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ - Cohere       â”‚
           â”‚  - Function    â”‚          â”‚ - Qdrant       â”‚
           â”‚    Calling     â”‚          â”‚                â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Data Structure

### Qdrant Point Schema

```json
{
  "id": 42,
  "vector": [0.123, -0.456, 0.789, ...],  // 1024 dimensions
  "payload": {
    "text": "ROS 2 is an open-source middleware...",
    "title": "ROS 2 Nodes and Topics",
    "module": "02-Module-1-ROS2",
    "file_path": "02-Module-1-ROS2/01-nodes-topics.mdx",
    "chunk_id": "abc123..."
  }
}
```

### Chat Request Schema

```json
{
  "message": "What is ROS 2?",
  "conversation_history": [
    {
      "role": "user",
      "content": "Hello"
    },
    {
      "role": "assistant",
      "content": "Hi! I'm your AI tutor..."
    }
  ]
}
```

### Chat Response Schema

```json
{
  "response": "ROS 2 (Robot Operating System 2) is...",
  "sources": [
    {
      "title": "ROS 2 Nodes and Topics",
      "module": "02-Module-1-ROS2",
      "file_path": "02-Module-1-ROS2/01-nodes-topics.mdx",
      "score": 0.92
    }
  ]
}
```

---

## âš¡ Performance Optimization Points

```
1. Embedding Cache
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Common queries  â”‚ â†’ Save embeddings
   â”‚ "What is X?"    â”‚   (avoid re-embedding)
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. Response Cache
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Frequent Qs     â”‚ â†’ Cache for 1 hour
   â”‚ "What is ROS?"  â”‚   (skip LLM call)
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. Batch Processing
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Multiple users  â”‚ â†’ Queue & batch
   â”‚ simultaneous    â”‚   (reduce API calls)
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. Streaming Response
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Stream tokens   â”‚ â†’ Show partial answer
   â”‚ from OpenAI     â”‚   (better UX)
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 1: Environment Variables         â”‚
â”‚  - API keys in .env (not in code)       â”‚
â”‚  - .gitignore prevents commit           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 2: CORS Middleware              â”‚
â”‚  - Only allow localhost:3000            â”‚
â”‚  - Reject other origins                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 3: Input Validation             â”‚
â”‚  - Pydantic models                      â”‚
â”‚  - Type checking                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 4: Agent Constitution           â”‚
â”‚  - System prompt restricts behavior     â”‚
â”‚  - No hallucination allowed             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Layer 5: Error Handling               â”‚
â”‚  - No stack traces to client            â”‚
â”‚  - Graceful degradation                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Scaling Strategy

```
Current (Single Instance)
    FastAPI Server
         â”‚
         â–¼
    Qdrant Cloud (1GB)
         â”‚
         â–¼
    Cohere API
         â”‚
         â–¼
    OpenAI API

Future (Scaled)
    Load Balancer
         â”‚
         â”œâ”€ FastAPI Instance 1
         â”œâ”€ FastAPI Instance 2
         â””â”€ FastAPI Instance 3
              â”‚
              â–¼
         Redis Cache (responses)
              â”‚
              â–¼
         Qdrant Cloud (Scaled)
              â”‚
              â–¼
         API Rate Limiter
              â”‚
              â”œâ”€ Cohere API
              â””â”€ OpenAI API
```

This visual architecture documentation provides a comprehensive view of how all components interact in the RAG chatbot system.